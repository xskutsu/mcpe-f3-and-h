import{system,world,ItemStack,ItemDurabilityComponent,EquipmentSlot,EntityItemComponent}from"@minecraft/server";let LoreHeader="\n§r§bF3&H Data",DatalessItemCooldownData=new Map([["minecraft:chorus_fruit",20],["minecraft:ender_pearl",20],["minecraft:goat_horn",140]]),DatalessItemNutritionData=new Map([["minecraft:apple",2],["minecraft:baked_potato",2.5],["minecraft:beetroot",.5],["minecraft:beetroot_soup",3],["minecraft:bread",2.5],["minecraft:carrot",1.5],["minecraft:chorus_fruit",2],["minecraft:cooked_beef",4],["minecraft:cooked_chicken",3],["minecraft:cooked_cod",2.5],["minecraft:cooked_mutton",3],["minecraft:cooked_porkchop",4],["minecraft:cooked_rabbit",2.5],["minecraft:cooked_salmon",3],["minecraft:cookie",1],["minecraft:dried_kelp",.5],["minecraft:enchanted_golden_apple",2],["minecraft:golden_apple",2],["minecraft:glow_berries",1],["minecraft:golden_carrot",3],["minecraft:honey_bottle",3],["minecraft:melon_slice",1],["minecraft:mushroom_stew",3],["minecraft:poisonous_potato",1],["minecraft:potato",.5],["minecraft:pufferfish",.5],["minecraft:pumpkin_pie",4],["minecraft:rabbit_stew",5],["minecraft:beef",1.5],["minecraft:chicken",1],["minecraft:cod",1],["minecraft:mutton",1],["minecraft:porkchop",1.5],["minecraft:rabbit",1.5],["minecraft:salmon",1],["minecraft:rotten_flesh",2],["minecraft:spider_eye",1],["minecraft:suspicious_stew",3],["minecraft:sweet_berries",1],["minecraft:tropical_fish",.5]]);function applyItemInfo(e){let t=!1;var n,o=e.getLore();if(/^better_on_bedrock:backpack/.test(e.typeId)&&0===o.length)return{changed:!1,itemStack:e};let a=o.indexOf(LoreHeader),i=(-1===a?(t=!0,o.push(LoreHeader),a=o.length):a++,"§r§7ID §r§6"+e.typeId);return 50<i.length&&(i="§r§7ID §6<too long>"),o[a++]!==i&&(o[a-1]=i,t=!0),e.hasComponent("durability")&&(n=`§r§7Durability §6${(n=e.getComponent("durability")).maxDurability-n.damage}/`+n.maxDurability,o[a++]!==n)&&(o[a-1]=n,t=!0),(e.hasComponent("food")||DatalessItemNutritionData.has(e.typeId))&&(n="§r§7Nutrition §6"+(e.getComponent("food")??{nutrition:DatalessItemNutritionData.get(e.typeId)}).nutrition,o[a++]!==n)&&(o[a-1]=n,t=!0),(e.hasComponent("cooldown")||DatalessItemCooldownData.has(e.typeId))&&(n=`§r§7Cooldown §6${(e.getComponent("cooldown")??{cooldownTicks:DatalessItemCooldownData.get(e.typeId)}).cooldownTicks} tick(s)`,o[a++]!==n)&&(o[a-1]=n,t=!0),t&&e.setLore(o),{changed:t,itemStack:e}}system.runInterval(function(){for(var e of world.getAllPlayers()){var t=e.getComponent("inventory");if(void 0!==t&&void 0!==t.container){for(let e=0;e<t.container.size;e++){var n=t.container.getItem(e);void 0!==n&&(n=applyItemInfo(n)).changed&&t.container.setItem(e,n.itemStack)}var o,a=e.getComponent("equippable");for(o of["Head","Chest","Legs","Feet"]){var i=a.getEquipment(o);void 0!==i&&(i=applyItemInfo(i)).changed&&a.setEquipment(o,i.itemStack)}e.isSneaking||void 0!==(e=a.getEquipment("Offhand"))&&(e=applyItemInfo(e)).changed&&a.setEquipment("Offhand",e.itemStack)}}},10),world.afterEvents.entitySpawn.subscribe(function(e){var t;"minecraft:item"===e.entity.typeId&&e.entity.hasComponent("item")&&(t=applyItemInfo(e.entity.getComponent("item").itemStack)).changed&&(e.entity.dimension.spawnItem(t.itemStack,e.entity.location),e.entity.remove())}),world.afterEvents.playerInteractWithBlock.subscribe(function(e){var t=e.block.getComponent("inventory");if(void 0!==t&&void 0!==t.container)for(let e=0;e<t.container.size;e++){var n=t.container.getItem(e);void 0!==n&&(n=applyItemInfo(n)).changed&&t.container.setItem(e,n.itemStack)}});